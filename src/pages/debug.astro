---
import { fetchGuideData } from '../utils/dataFetcher';

let guideItems = [];
let error = '';

try {
  guideItems = await fetchGuideData();
  console.log('Guide items:', guideItems);
} catch (e) {
  error = `データの取得に失敗しました: ${e instanceof Error ? e.message : '不明なエラー'}`;
  console.error('Fetch error:', e);
}

import Layout from '../layouts/Layout.astro';
---

<Layout title="Debug - Guide Data">
  <main style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
    <h1>Guide Data Debug</h1>

    {error ? (
      <div style="background: #ffebee; padding: 1rem; border-radius: 8px; color: #c62828;">
        <h2>エラー</h2>
        <p>{error}</p>
      </div>
    ) : null}

    {guideItems.length > 0 ? (
      <div style="margin: 2rem 0;">
        <h2>Guide Items ({guideItems.length} items)</h2>
        {guideItems.slice(0, 3).map((item: any) => (
          <div style="margin: 1rem 0; padding: 1rem; background: #f9f9f9; border-radius: 8px; border-left: 4px solid #1976d2;">
            <h3 style="margin: 0 0 1rem 0; color: #1976d2;">{item.name_en || item.name_ja}</h3>
            <div style="display: grid; grid-template-columns: 150px 1fr; gap: 0.5rem; font-size: 0.9rem;">
              <strong>item_id:</strong> <span style="color: #0d47a1;">{item.item_id}</span>
              <strong>pin_id:</strong> <span style="color: #c62828; font-weight: bold;">{item.pin_id || 'NOT SET'}</span>
              <strong>name_en:</strong> <span>{item.name_en}</span>
              <strong>name_ja:</strong> <span>{item.name_ja}</span>
            </div>
            <div style="margin-top: 1rem; padding: 0.5rem; background: #e3f2fd; border-radius: 4px;">
              <strong>Deep Link URL:</strong><br/>
              <code style="word-break: break-all;">https://mop-okinawa.com/?pin_id={item.pin_id}&lang=en</code>
            </div>
          </div>
        ))}
      </div>
    ) : (
      <p>No guide items found</p>
    )}

    <div style="margin-top: 2rem;">
      <a href="/" style="color: #1976d2; text-decoration: none;">← メインページに戻る</a>
    </div>
  </main>
</Layout>